---
title: "Changing populations in European cities 1500-1800"
author:
date: '2018-03-15'
description: A few different looks at changes in population across European cities
  between the 16th and 18th centuries
draft: no
slug: changing-pops-european-cities
subdirectory: post
tags:
- maps
- r
- cities
- history
categories:
- visualization
- maps
- blog
---

This is a demo

```{r message=FALSE, warning=FALSE}
# install europop package
# install.packages("europop")

library(dplyr)
library(europop)
library(sf)

# Create spatial object
euro_cities <- left_join(europop, city_coords) %>% 
  st_as_sf(coords = c("lon", "lat"), crs = 4326) %>% 
  filter(region == "Germany")

# install.packages("mapview")
library(mapview)
library(ggplot2)
library(purrr)
library(leaflet)

inset_plot <- function(sel_city, df) {
  ggplot(df %>% filter(city == sel_city), aes(x = year, y = population)) + geom_line() + labs(title = sel_city, x = "", y = "", theme_minimal())
}

city_list <- unique(euro_cities$city)

inset_list <- map(.x = city_list, .f = inset_plot, df = euro_cities)

# pop.plots = mapview::popupGraph(inset_list, type='png')

# leaflet() %>% 
#   addProviderTiles("Stamen.Terrain", group='Terrain') %>% 
#   addCircleMarkers(data=euro_cities, popup=~pop.plots)

mapview(euro_cities %>% distinct(city, region, geometry), popup = popupGraph(inset_list, type = "png"))

```
